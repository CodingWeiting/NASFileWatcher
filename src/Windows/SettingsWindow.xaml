<Window x:Class="NASFileWatcher.Windows.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="設定" 
        Height="550" 
        Width="600"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- NAS 路徑 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <Label Content="NAS 路徑:" FontWeight="Bold"/>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="NasPathTextBox"
                         Grid.Column="0"
                         Height="30"
                         VerticalContentAlignment="Center"
                         ToolTip="例如: \\192.168.1.100\FamilyLibrary"
                         Margin="0,0,10,0"/>
                <Button x:Name="BrowseNasButton"
                        Grid.Column="1"
                        Content="📁 瀏覽"
                        Width="80"
                        Height="30"
                        Click="BrowseNasButton_Click"/>
            </Grid>
            <TextBlock Text="例如: \\192.168.1.100\FamilyLibrary 或本機路徑 C:\Data"
                       Foreground="Gray"
                       FontSize="10"
                       Margin="0,3,0,0"/>
        </StackPanel>

        <!-- Webhook URL -->
        <StackPanel Grid.Row="1" Margin="0,0,0,15">
            <Label Content="n8n Webhook URL:" FontWeight="Bold"/>
            <TextBox x:Name="WebhookUrlTextBox" 
                     Height="30" 
                     VerticalContentAlignment="Center"
                     ToolTip="n8n Webhook 的完整 URL"/>
            <TextBlock Text="例如: https://your-n8n.com/webhook/file-change" 
                       Foreground="Gray" 
                       FontSize="10" 
                       Margin="0,3,0,0"/>
        </StackPanel>

        <!-- 防抖動時間 -->
        <StackPanel Grid.Row="2" Margin="0,0,0,15">
            <Label Content="防抖動時間 (秒):" FontWeight="Bold"/>
            <StackPanel Orientation="Horizontal">
                <Slider x:Name="DebounceSlider" 
                        Width="400" 
                        Minimum="1" 
                        Maximum="10" 
                        TickFrequency="1" 
                        IsSnapToTickEnabled="True"
                        VerticalAlignment="Center"/>
                <TextBlock Text="{Binding ElementName=DebounceSlider, Path=Value}" 
                           Margin="10,0,0,0" 
                           VerticalAlignment="Center"
                           FontWeight="Bold"/>
            </StackPanel>
            <TextBlock Text="同一檔案在此時間內的多次變動只會通知一次" 
                       Foreground="Gray" 
                       FontSize="10" 
                       Margin="0,3,0,0"/>
        </StackPanel>

        <!-- 啟用日誌 -->
        <StackPanel Grid.Row="3" Margin="0,0,0,15">
            <CheckBox x:Name="EnableLoggingCheckBox" 
                      Content="啟用詳細日誌記錄" 
                      VerticalAlignment="Center"/>
            <TextBlock Text="記錄所有檔案變動資訊到日誌檔" 
                       Foreground="Gray" 
                       FontSize="10" 
                       Margin="20,3,0,0"/>
        </StackPanel>

        <!-- 批次通知設定 -->
        <GroupBox Grid.Row="4" Header="批次通知設定" Margin="0,0,0,15" Padding="10">
            <StackPanel>
                <CheckBox x:Name="EnableBatchCheckBox" 
                          Content="啟用智慧批次通知"
                          Margin="0,0,0,10"/>
                
                <StackPanel Margin="0,0,0,10">
                    <Label Content="批次閾值 (超過此數量啟用批次):" FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal">
                        <Slider x:Name="BatchThresholdSlider" 
                                Width="300" 
                                Minimum="5" 
                                Maximum="50" 
                                TickFrequency="5" 
                                IsSnapToTickEnabled="True"
                                VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ElementName=BatchThresholdSlider, Path=Value}" 
                                   Margin="10,0,0,0" 
                                   VerticalAlignment="Center"
                                   FontWeight="Bold"/>
                        <TextBlock Text="個檔案" 
                                   Margin="5,0,0,0" 
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel>
                    <Label Content="批次時間窗口 (秒):" FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal">
                        <Slider x:Name="BatchWindowSlider" 
                                Width="300" 
                                Minimum="5" 
                                Maximum="60" 
                                TickFrequency="5" 
                                IsSnapToTickEnabled="True"
                                VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ElementName=BatchWindowSlider, Path=Value}" 
                                   Margin="10,0,0,0" 
                                   VerticalAlignment="Center"
                                   FontWeight="Bold"/>
                        <TextBlock Text="秒" 
                                   Margin="5,0,0,0" 
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock Text="此時間內的多個變動會合併為一則通知" 
                               Foreground="Gray" 
                               FontSize="10" 
                               Margin="0,3,0,0"/>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <!-- 說明 -->
        <Border Grid.Row="5" 
                Background="#FFF9F9F9" 
                BorderBrush="#FFCCCCCC" 
                BorderThickness="1" 
                Padding="10"
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="注意事項:" FontWeight="Bold" Margin="0,0,0,5"/>
                <TextBlock TextWrapping="Wrap">
                    • 修改設定後會自動重新啟動監控服務<LineBreak/>
                    • 請確保 NAS 路徑可以正常存取<LineBreak/>
                    • 程式會自動過濾 .0001.rfa 等備份檔案<LineBreak/>
                    • 日誌檔案會自動保留 30 天<LineBreak/>
                    • 批次通知可避免大量上傳時洗版 Slack
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- 測試連線按鈕 -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" Margin="0,0,0,15">
            <Button x:Name="TestNasButton" 
                    Content="測試 NAS 連線" 
                    Width="120" 
                    Height="30" 
                    Margin="0,0,10,0"
                    Click="TestNasButton_Click"/>
            <Button x:Name="TestWebhookButton" 
                    Content="測試 Webhook" 
                    Width="120" 
                    Height="30"
                    Click="TestWebhookButton_Click"/>
        </StackPanel>

        <!-- 按鈕 -->
        <StackPanel Grid.Row="7" Orientation="Horizontal" HorizontalAlignment="Right">
            <TextBlock Text="✅ 設定會自動儲存"
                       VerticalAlignment="Center"
                       Foreground="Green"
                       FontWeight="Bold"
                       Margin="0,0,10,0"/>
            <Button Content="關閉"
                    Width="80"
                    Height="30"
                    IsDefault="True"
                    Click="CloseButton_Click"/>
        </StackPanel>
    </Grid>
</Window>
