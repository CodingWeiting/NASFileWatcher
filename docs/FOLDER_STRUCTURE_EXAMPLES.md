# 資料夾結構顯示範例

## 功能說明

當批次通知包含大量檔案時,程式會自動分析資料夾結構,顯示各資料夾的檔案變動數量,讓你一眼看出是哪些資料夾在變動。

---

## 📊 顯示邏輯

### 小量檔案 (10-100 個)
顯示: **檔案清單** (前 10 個檔案)

### 大量檔案 (100-500 個)
顯示: **資料夾結構** (前 10 個資料夾) + 警告標示

### 超大量檔案 (500+ 個)
顯示: **資料夾結構** (前 15 個資料夾) + 嚴重警告

---

## 實際範例

### 範例 1: 50 個檔案 (顯示檔案清單)

**情境:** 上傳 50 個鋼構族群

```
📦 批次檔案變動 (共 50 個檔案)

📊 變動統計:
  📁 新增: 50 個

⏰ 時間範圍: 14:30:00 - 14:30:15

📋 檔案清單:
  📁 H型鋼-300x150.rfa
  📁 H型鋼-400x200.rfa
  📁 I型鋼-250x125.rfa
  📁 C型鋼-200x80.rfa
  📁 角鋼-100x100.rfa
  📁 槽鋼-150x75.rfa
  📁 T型鋼-200x200.rfa
  📁 方管-100x100.rfa
  📁 圓管-60.5.rfa
  📁 矩形管-150x100.rfa
  ... 還有 40 個檔案

💡 提示: 檢查是否為批次同步或上傳操作
```

---

### 範例 2: 150 個檔案 (顯示資料夾結構)

**情境:** 上傳整個結構族群庫,分散在不同資料夾

```
📦 批次檔案變動 (共 150 個檔案) ⚠️

📊 變動統計:
  📁 新增: 150 個

⏰ 時間範圍: 14:30:00 - 14:31:30

📂 資料夾結構:
📁 `結構\鋼構` - 85 個 (+85)
  📁 `結構\鋼構\H型鋼` - 30 個 (+30)
  📁 `結構\鋼構\I型鋼` - 25 個 (+25)
  📁 `結構\鋼構\C型鋼` - 15 個 (+15)
  📁 `結構\鋼構\其他` - 15 個 (+15)
📁 `結構\RC` - 45 個 (+45)
  📁 `結構\RC\柱` - 20 個 (+20)
  📁 `結構\RC\梁` - 15 個 (+15)
  📁 `結構\RC\版` - 10 個 (+10)
📁 `結構\基礎` - 20 個 (+20)

💡 提示: 檢查是否為批次同步或上傳操作
📋 完整清單請查看程式日誌檔
```

---

### 範例 3: 500 個檔案混合操作

**情境:** 大量更新整個族群庫,包含新增、修改、刪除

```
📦 批次檔案變動 (共 523 個檔案) ⚠️

📊 變動統計:
  📁 新增: 350 個
  ✏️ 修改: 150 個
  🗑️ 刪除: 23 個

⏰ 時間範圍: 14:30:00 - 14:35:20

📂 資料夾結構:
📁 `結構\鋼構` - 280 個 (+200, ~70, -10)
  📁 `結構\鋼構\H型鋼` - 120 個 (+80, ~35, -5)
  📁 `結構\鋼構\I型鋼` - 85 個 (+60, ~20, -5)
  📁 `結構\鋼構\C型鋼` - 45 個 (+35, ~10)
  📁 `結構\鋼構\管材` - 30 個 (+25, ~5)
📁 `結構\RC` - 150 個 (+100, ~45, -5)
  📁 `結構\RC\柱` - 60 個 (+40, ~18, -2)
  📁 `結構\RC\梁` - 50 個 (+35, ~15)
  📁 `結構\RC\版` - 40 個 (+25, ~12, -3)
📁 `結構\基礎` - 50 個 (+30, ~18, -2)
📁 `結構\樓梯` - 28 個 (+15, ~10, -3)
📁 `結構\其他` - 15 個 (+5, ~7, -3)

💡 提示: 檢查是否為批次同步或上傳操作
📋 完整清單請查看程式日誌檔
```

**說明符號:**
- `+N` = 新增 N 個
- `~N` = 修改 N 個  
- `-N` = 刪除 N 個

---

### 範例 4: 1000 個檔案 (嚴重警告)

**情境:** 同步整個公司族群庫或誤刪大量檔案

```
🚨 大量檔案變動警告 (共 1,235 個檔案)

📊 變動統計:
  📁 新增: 1,000 個
  ✏️ 修改: 200 個
  🗑️ 刪除: 35 個

⏰ 時間範圍: 14:30:00 - 14:40:15

📂 資料夾結構:
📁 `結構` - 580 個 (+500, ~75, -5)
  📁 `結構\鋼構` - 320 個 (+280, ~35, -5)
    📁 `結構\鋼構\H型鋼` - 150 個 (+130, ~20)
    📁 `結構\鋼構\I型鋼` - 100 個 (+90, ~10)
    📁 `結構\鋼構\C型鋼` - 40 個 (+35, ~5)
    📁 `結構\鋼構\管材` - 30 個 (+25, ~5)
  📁 `結構\RC` - 180 個 (+150, ~28, -2)
  📁 `結構\基礎` - 50 個 (+40, ~8, -2)
  📁 `結構\樓梯` - 30 個 (+25, ~4, -1)
📁 `建築` - 420 個 (+350, ~65, -5)
  📁 `建築\門窗` - 180 個 (+150, ~28, -2)
  📁 `建築\牆` - 120 個 (+100, ~18, -2)
  📁 `建築\天花板` - 80 個 (+70, ~9, -1)
  📁 `建築\其他` - 40 個 (+30, ~10)
📁 `MEP` - 235 個 (+150, ~60, -25)
  ... 還有 5 個資料夾

⚠️ 重要提醒:
  • 這是非常大量的檔案變動
  • 請確認是否為預期的操作
  • 建議檢查:批次同步/備份/誤刪
  • 完整清單請查看程式日誌檔
```

---

### 範例 5: 刪除整個資料夾 (300 個檔案)

**情境:** 誤刪或清理舊版族群

```
📦 批次檔案變動 (共 312 個檔案) ⚠️

📊 變動統計:
  🗑️ 刪除: 312 個

⏰ 時間範圍: 14:30:00 - 14:30:08

📂 資料夾結構:
📁 `結構\舊版_2023` - 312 個 (-312)
  📁 `結構\舊版_2023\鋼構` - 180 個 (-180)
    📁 `結構\舊版_2023\鋼構\H型鋼` - 80 個 (-80)
    📁 `結構\舊版_2023\鋼構\I型鋼` - 60 個 (-60)
    📁 `結構\舊版_2023\鋼構\其他` - 40 個 (-40)
  📁 `結構\舊版_2023\RC` - 100 個 (-100)
  📁 `結構\舊版_2023\基礎` - 32 個 (-32)

💡 提示: 檢查是否為批次同步或上傳操作
📋 完整清單請查看程式日誌檔
```

---

## 🎯 資料夾結構說明

### 顯示格式

```
📁 `資料夾路徑` - 總數 (操作統計)
```

### 縮排規則

- 一層資料夾: 無縮排
- 二層資料夾: 2 個空格縮排
- 三層以上: 4 個空格縮排 (最多)

### 排序規則

資料夾按檔案數量**由多到少**排序,讓你先看到變動最多的資料夾。

### 顯示數量

| 總檔案數 | 顯示資料夾數 |
|---------|-------------|
| 100-500 | 前 10 個 |
| 500+    | 前 15 個 |

---

## 📋 Webhook JSON 格式

```json
{
  "event_type": "batch",
  "total_count": 523,
  "created_count": 350,
  "modified_count": 150,
  "deleted_count": 23,
  "start_time": "2025-11-17T14:30:00+08:00",
  "end_time": "2025-11-17T14:35:20+08:00",
  "common_path": "結構",
  "files": [...],
  "folder_structure": [
    {
      "folderPath": "結構\\鋼構",
      "totalFiles": 280,
      "createdCount": 200,
      "modifiedCount": 70,
      "deletedCount": 10,
      "depth": 2
    },
    {
      "folderPath": "結構\\鋼構\\H型鋼",
      "totalFiles": 120,
      "createdCount": 80,
      "modifiedCount": 35,
      "deletedCount": 5,
      "depth": 3
    }
  ]
}
```

---

## 💡 使用建議

### 快速判斷情境

**看到資料夾結構時,可以快速判斷:**

1. **單一資料夾大量變動**
   - 可能: 批次上傳新族群
   - 建議: 確認是否為預期操作

2. **多個資料夾均勻變動**
   - 可能: 整個族群庫同步
   - 建議: 確認同步來源

3. **大量刪除**
   - 可能: 清理舊版或誤刪
   - 建議: 立即檢查並備份

4. **混合操作**
   - 可能: 大規模更新
   - 建議: 檢查變更記錄

---

## 🔍 搭配日誌使用

雖然 Slack 訊息只顯示摘要,但**完整的檔案清單都記錄在日誌中**:

**日誌檔位置:** `Logs/2025-11-17.log`

**日誌內容範例:**
```
[2025-11-17 14:30:00] [Info] 開始處理批次變動: 523 個檔案
[2025-11-17 14:30:00] [Info] 新增: 結構\鋼構\H型鋼\H-300x150.rfa
[2025-11-17 14:30:00] [Info] 新增: 結構\鋼構\H型鋼\H-400x200.rfa
[2025-11-17 14:30:00] [Info] 修改: 結構\RC\柱\C-600x600.rfa
... (所有 523 個檔案)
[2025-11-17 14:30:01] [Info] 批次通知已發送: 523 個檔案變動
```

透過日誌可以:
- 查看完整檔案清單
- 追蹤每個檔案的變動時間
- 事後稽核和分析

---

## 常見問題

### Q: 為什麼有時顯示檔案清單,有時顯示資料夾結構?

**A:** 
- **少於 100 個檔案**: 顯示檔案清單,方便看每個檔案
- **超過 100 個檔案**: 顯示資料夾結構,更容易理解整體變動

### Q: 資料夾結構最多顯示幾層?

**A:** 為了訊息簡潔,最多顯示 3 層縮排。更深的資料夾路徑會完整顯示,但縮排不會超過 3 層。

### Q: 可以看到所有資料夾嗎?

**A:** 
- Slack 訊息顯示前 10-15 個 (依檔案總數)
- 完整資料夾列表在程式日誌中

### Q: 符號 (+80, ~35, -5) 是什麼意思?

**A:**
- `+80` = 新增 80 個檔案
- `~35` = 修改 35 個檔案
- `-5` = 刪除 5 個檔案

---

**現在大量上傳也能清楚看到資料夾結構了!** 🎉
